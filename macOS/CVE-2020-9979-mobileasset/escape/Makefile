ESCAPE=Mojave/exploit.m Mojave/WebCoreApi.c \
	../utils/DictAssets.m

SOURCES=loader/bootstrap.c loader/payload.m $(ESCAPE)


SHELLCODE_CFLAGS = \
	-Wno-implicit-function-declaration \
	-fno-stack-protector \
	-fPIE \
	-fPIC


FRAMEWORKS= \
	-framework Foundation \
	-framework AppKit \
	-F /System/Library/PrivateFrameworks/ \
	-framework MobileAsset

OUTPUT=./bin
EXEC=$(OUTPUT)/escape


all: payload

payload:
	cd loader; make loader dylib; cd ..; mv loader/bin/{shellcode,escape.dylib} $(OUTPUT)

run: cli
	$(EXEC)

cli: prepare
	cc cli.m $(ESCAPE) $(FRAMEWORKS) -o $(EXEC)

test: cli
	$(EXEC)

prepare:
	mkdir -p $(OUTPUT)

clean:
	rm -rf $(OUTPUT)/*